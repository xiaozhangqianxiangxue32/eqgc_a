# 航迹点可视化使用指南

## 修改内容

### 1. C++ 代码修改

#### `utils.h` 新增功能
- 添加了 `saveWaypoints()` 函数，用于保存A*规划器生成的航迹点到CSV文件
- 格式: `Index, Lat_deg, Lon_deg`

#### `EQGC_A.cpp` 主程序修改
- 添加了航迹点文件路径: `waypoints.csv`
- 在路径规划完成后调用 `saveWaypoints()` 保存规划路径
- 输出文件位置: `D:\4-program\1\eqgc\result\waypoints.csv`

### 2. MATLAB 可视化脚本

#### 新脚本: `plot_results_with_waypoints.m`
主要功能：
1. **同时显示规划路径和实际轨迹**
   - 红色虚线 + 圆点：规划的航迹点
   - 蓝色实线：实际飞行轨迹
   
2. **3D视图 (Figure 1)**
   - 显示三维飞行轨迹
   - 航迹点投影到初始高度
   - 标注航迹点序号 (WP0, WP1, ...)
   
3. **地面轨迹对比 (Figure 2)** - 重点图
   - 清晰对比规划路径与实际轨迹
   - 显示禁飞区
   - 标注起点、终点、航迹点序号
   
4. **飞行状态图 (Figure 3)**
   - H-V剖面
 - 航迹倾角
   - 航向角
   - 速度-时间曲线
   
5. **控制量图 (Figure 4)**
   - 攻角 (Alpha)
   - 滚转角 (Bank)

## 使用步骤

### 步骤 1: 运行 C++ 仿真
```bash
# 在 Visual Studio 中编译并运行
# 或在命令行运行编译后的可执行文件
EQGC_A.exe
```

**输出文件 (位于 `D:\4-program\1\eqgc\result\`)**:
- `bao_simulation.csv` - 仿真轨迹数据
- `mission_config.csv` - 任务配置(起点/终点/禁飞区)
- `waypoints.csv` - **新增** 规划的航迹点

### 步骤 2: MATLAB 可视化
```matlab
% 在 MATLAB 中运行
cd('D:\4-program\1\eqgc\EQGC_A')
plot_results_with_waypoints
```

## 输出文件格式

### `waypoints.csv`
```csv
Index,Lat_deg,Lon_deg
0,0.000000,0.000000
1,1.234567,12.345678
2,3.456789,34.567890
...
```

## 图例说明

### Figure 2 (地面轨迹) - 最重要的对比图
- **红色虚线 + 圆点**: 规划的航迹点连线
- **蓝色粗实线**: 实际飞行轨迹
- **红色圆圈**: 禁飞区
- **绿色圆点**: 起点
- **黑色叉号**: 目标点
- **红色数字**: 航迹点序号 (0, 1, 2, ...)

### 观察重点
1. **实际轨迹是否跟随航迹点**: 蓝线应该经过或接近红点
2. **是否绕开禁飞区**: 轨迹不应穿过红色圆圈
3. **直连终点的效果**: 观察轨迹在可以看到终点时是否直接连接

## 预期效果

修改后的 A* 规划器应该：
- 每个节点优先检查能否直连终点
- 一旦可以直连，立即连接，不再绕行
- 生成的航迹点更少、更直接
- 实际飞行轨迹应该更平滑地接近目标

## 故障排查

### 问题: 未找到航迹点文件
**原因**: C++ 程序未正确保存航迹点
**解决**: 
- 检查 C++ 程序是否成功运行
- 检查控制台是否显示: `[Config] Waypoints saved to: ...`
- 确认文件路径正确

### 问题: 图形显示不全
**原因**: 数据范围问题
**解决**: 
- 在 Figure 2 中使用 `axis equal` 确保比例正确
- 可以手动调整: `xlim([min_lon max_lon]); ylim([min_lat max_lat]);`

### 问题: 航迹点太少
**原因**: A* 规划器找到了非常直接的路径
**说明**: 这是正常的！说明优化有效

## 下一步

如果需要进一步分析：
1. 添加航迹点与实际轨迹的偏差统计
2. 计算路径长度对比 (规划 vs 实际)
3. 分析制导律的跟踪性能
